name: Refresh Demo Data

on:
  schedule:
    - cron: '0 */2 * * *'
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Create timestamp file
      run: |
        mkdir -p animal-humane/react-app/public/api/
        current_date=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
        human_date=$(date -u +"%B %d, %Y at %I:%M %p UTC")
        echo "{
          \"lastUpdated\": \"$current_date\",
          \"human_readable\": \"$human_date\",
          \"timestamp\": $(date +%s)
        }" > animal-humane/react-app/public/api/last-updated.json
        echo "Created timestamp file:"
        cat animal-humane/react-app/public/api/last-updated.json
        
    - name: Commit and push
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: 'Update demo timestamp'
        file_pattern: 'animal-humane/react-app/public/api/last-updated.json'